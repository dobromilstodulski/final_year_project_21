{% extends "base.html" %}

{% block content %}

<div class="container col-xl-10 col-xxl-8 px-4 py-5">
    <div class="row align-items-center g-lg-5 py-5">
        <div class="col-md-10 mx-auto col-lg-5">

            <input type="hidden" id="username" name="username" value="{{ current_user.id }}">

            {% for msg in msgs %}
            <div class="card">
                <h5 class="card-header">{{msg.username}}</h5>
                <div class="card-body">
                    {{msg.message}}
                </div>
            </div>
            {% endfor %}

            <input id="chat_text" class="input" type="text">
            <a id="chat_btn" class="button is-info">
                Post
            </a>

        </div>
    </div>
</div>

<script>

    $(function () {

        $('#chat_btn').on('click', function () {

            let username = $('#username').val();

            let message = $('#chat_text').val();

            $.post('/message', { 'message': message }, function () {
                $('#chat_text').val('');
            });

        });

        // Enable pusher logging - don't include this in production
        Pusher.logToConsole = true;

        var pusher = new Pusher('6eb53b420f4f837b63e2', {
            cluster: 'eu',
            encrypted: true
        });

        var channel = pusher.subscribe('chat-channel');

        channel.bind('new-message', function (data) {

            let name = data.username;
            let message = data.message;

            let message_template = `<article class="media">
                                  <div class="media-content">
                                    <div class="content">
                                      <p>
                                        <strong>${name}</strong>
                                        <br> ${message}
                                      </p>
                                    </div>
                                  </div>
                                </article>`;

            $('#content').append(message_template);

        });



    });

</script>


{% endblock %}